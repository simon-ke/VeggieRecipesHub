<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="綠藝饗宴 - 最佳素食食譜平台" />
    <title>食譜瀏覽 - 綠藝饗宴</title>
    <link rel="stylesheet" href="../CSS/recipeSelector.css" />
</head>

<body>
    <!-- 頁首 -->
    <header>
        <!-- 導覽列 -->
        <nav class="nav-container">
            <!-- 第一列 -->
            <div class="member-menu">
                <a href="#">
                    <img class="login-singup" src="../img/icons/user.png" alt="登入註冊" />
                    <span class="tooltip">登入註冊</span>
                </a>
                <a href="#">
                    <img class="shopping-cart" src="../img/icons/shopping-cart.png" alt="購物車" />
                    <span class="tooltip">購物車</span>
                </a>
                <a href="#">
                    <img class="contact-us" src="../img/icons/message.png" alt="聯絡我們" />
                    <span class="tooltip">聯絡我們</span>
                </a>
            </div>

            <!-- 第二列 -->
            <div class="logo-container">
                <a href="../index.html"><img class="logo" src="../img/vegetable_LOGO.jpg" alt="綠藝饗宴 LOGO" /></a>
                <a href="../index.html">
                    <h1 class="site-title">綠藝饗宴</h1>
                </a>
            </div>

            <!-- 第三列 -->
            <div class="menu-container">
                <div class="hamburger-menu" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="main-menu">
                    <li><a href="../index.html">首頁</a></li>
                    <li class="dropdown">
                        <a href="#">食譜分類&#9662;</a>
                        <ul class="submenu">
                            <li><a href="./recipeSelector.html">早餐</a></li>
                            <li><a href="./recipeSelector.html">飯</a></li>
                            <li><a href="./recipeSelector.html">麵</a></li>
                            <li><a href="./recipeSelector.html">米粉</a></li>
                            <li><a href="./recipeSelector.html">蔬菜</a></li>
                            <li><a href="./recipeSelector.html">鹹點</a></li>
                            <li><a href="./recipeSelector.html">甜點</a></li>
                        </ul>
                    </li>
                    <li><a href="#">營養資訊</a></li>
                    <li><a href="#">購物清單</a></li>
                    <li><a href="#">聯絡我們</a></li>
                    <li><a href="#">常見問題</a></li>
                </ul>
            </div>
        </nav>
        <!-- 第四列 -->
        <div class="recipe-actions">
            <!-- 搜尋區塊 -->
            <div class="search-container">
                <label>立即探索食譜</label>
                <form>
                    <input type="text" id="search" name="search" placeholder="搜尋食譜或輸入食材" />
                    <button type="submit">
                        <img class="search-icon" src="../img/icons/search.png" alt="搜尋" />
                    </button>
                </form>
            </div>
            <!-- 上傳食譜 -->
            <a class="upload-button" href="./uploadRecipe.html">上傳您的素食食譜</a>
        </div>
    </header>

    <!-- 內容 -->
    <div class="recipeSelector-container">
        <!-- 頁面頂部篩選和排序選項 -->
        <div class="filter-sort-container">
            <label for="sort">排序：</label>
            <select id="sort" name="sort">
                <option value="all">全部</option>
                <option value="time">烹飪時間</option>
                <option value="difficulty">難度</option>
                <option value="rating">評價</option>
                <option value="latest">最新</option>
                <option value="popular">最受歡迎</option>
            </select>
            <label for="filter">篩選：</label>
            <select id="filter" name="filter">
                <option value="vegetables">蔬菜</option>
                <option value="quick-dish">快手菜</option>
                <option value="healthy-cooking">健康料理</option>
                <option value="vegan">純素</option>
                <option value="lacto-ovo-vegetarian">蛋奶素</option>
                <option value="gluten-free">無麩質</option>
            </select>
        </div>

        <!-- 頁籤 -->
        <div class="breadcrumb">
            <a href="../index.html">首頁</a>
            >
            <a href="./recipeSelector.html">蔬菜</a>
        </div>

        <!-- 燈箱結構 -->
        <div class="lightbox" id="lightbox">
            <div class="lightbox-content">
                <img src="" alt="放大檢視" id="lightbox-img" />
            </div>
        </div>

        <!-- 食譜簡介卡片 -->
        <div id="recipeCardContainer"><!-- 動態生成各類食譜 --></div>

        <!-- 最新/推薦食譜 -->
        <div class="featured-recipes">
            <h2>推薦食譜</h2>
            <div class="featured-carousel" id="featuredCarousel">
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/綜合烤蔬菜.jpg" alt="Recipe Image 3" />
                        <h3>香草烤蔬菜</h3>
                        <div class="tags">
                            <span>低碳水</span>
                        </div>
                        <p>
                            這道香草烤蔬菜色彩繽紛，味道濃郁，是一道健康又美味的素食料理。選用新鮮蔬菜，搭配香草和橄欖油烤至香脆，適合作為主菜或配菜。
                        </p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.8 / 5 （250 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/香料烤胡蘿蔔.jpg" alt="Spiced Roasted Carrots" />
                        <h3>香料烤胡蘿蔔</h3>
                        <div class="tags">
                            <span>快速</span>
                            <span>健康</span>
                        </div>
                        <p>利用各種香料和草本來提升胡蘿蔔的風味，簡單美味的健康小吃。</p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.7 / 5 （180 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/橄欖油義大利麵.jpg" alt="Garlic Olive Oil Pasta" />
                        <h3>橄欖油義大利麵</h3>
                        <div class="tags">
                            <span>快速</span>
                        </div>
                        <p>
                            簡單的義大利麵食譜，只需幾種食材，就能享受橄欖油的絕妙搭配。
                        </p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.5 / 5 （220 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/香草烤花椰菜.jpg" alt="Herb Roasted Cauliflower" />
                        <h3>香草烤花椰菜</h3>
                        <div class="tags">
                            <span>健康</span>
                            <span>低熱量</span>
                        </div>
                        <p>將花椰菜與新鮮香草和橄欖油一起烘烤，外脆內嫩，口感豐富。</p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.6 / 5 （150 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/鮮菇炒菠菜.jpg" alt="Lemon Garlic Sauteed Spinach" />
                        <h3>鮮菇炒菠菜</h3>
                        <div class="tags">
                            <span>快速</span>
                        </div>
                        <p>菠菜搭配鮮菇簡單快速的營養佳餚。</p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.8 / 5 （200 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
                <div class="featured-recipe-card">
                    <a href="./recipe.html">
                        <img src="../img/食譜圖片/椰奶咖哩豆腐.jpg" alt="Coconut Curry Tofu" />
                        <h3>椰奶咖哩豆腐</h3>
                        <div class="tags">
                            <span>異國風味</span>
                        </div>
                        <p>
                            以椰奶和咖哩燉煮豆腐，搭配米飯或麵食，口感豐富順口且充滿異國風情。
                        </p>
                    </a>
                    <div class="actions">
                        <a href="#">評分：4.9 / 5 （300 評價）</a>
                        <div>
                            <button>收藏</button>
                            <button>分享</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 反饋區塊 -->
        <div class="feedback-section">
            <h3>您的反饋</h3>
            <form action="#" method="POST">
                <textarea name="feedback" id="feedback" rows="4" placeholder="請留下您的意見和建議"></textarea>
                <button type="submit">提交</button>
            </form>
        </div>
    </div>

    <!-- 回到頂部按鈕 -->
    <img id="back-to-top" class="up-arrow" src="../img/icons/up-arrow_11044298.png" alt="回到頂部" />

    <!-- 頁尾 -->
    <footer>
        <div class="footer-container">
            <div class="footer-links">
                <a href="#">關於我們</a>
                <a href="#">常見問題</a>
                <a href="#">隱私政策</a>
                <a href="#">使用條款</a>
                <a href="#">聯絡我們</a>
            </div>
            <div class="social-media-icons">
                <a href="#"><img src="../img/icons/line.png" alt="Line" /></a>
                <a href="#"><img src="../img/icons/instagram.png" alt="Instagram" /></a>
                <a href="#"><img src="../img/icons/facebook.png" alt="Facebook" /></a>
            </div>
            <p>Copyright &copy; 2025 綠藝饗宴</p>
        </div>
    </footer>

    <script src="../JS/recipeSelector.js"></script>
    <script src="../JS/all.js"></script>

    <script>
        // 取得預設數據（從 JSON 檔案）與 localStorage 中的數據
        function getRecipesData() {
            // 從 localStorage 取得用戶新增的數據
            const storedData = localStorage.getItem("recipesData");
            const storedRecipes = storedData ? JSON.parse(storedData) : [];

            // 透過 fetch 取得預設數據
            return fetch("../recipes.json")
                .then((response) => response.json())
                .then((defaultRecipes) => {
                    // 合併預設數據與 localStorage 數據
                    // 此處假設兩者皆為陣列
                    return [...defaultRecipes, ...storedRecipes];
                });
        }

        // 取得食譜數據 建立頁面內容
        getRecipesData()
            .then(recipesData => {
                // console.log('食譜數據：', recipesData);
                // 食譜卡片區塊
                const recipeCardContainer = document.getElementById("recipeCardContainer");
                // 使用 DocumentFragment 優化多次 DOM 插入 如果食譜數據筆數較多，插入每個新的元素到 DOM 都可能引發重排（reflow）與重繪（repaint）。使用 DocumentFragment 來先建立所有卡片，最後一次性把碎片插入到 DOM，從而減少瀏覽器的重排次數。
                const fragment = document.createDocumentFragment();
                // 迭代 storedRecipes 並建立食譜卡片
                recipesData.forEach(recipe => {
                    const card = createRecipeCard(recipe);
                    // 將 card 插入 fragment
                    fragment.append(card);
                });
                // 一次性把所有卡片插入容器
                recipeCardContainer.append(fragment);
            })
            .catch((error) => console.error("取得食譜數據時出錯:", error));

        //     // 生成推薦卡片
        //     const featuredCarousel = document.getElementById('featuredCarousel');
        //     // featuredCarousel.innerHTML = ''; // 清空原本內容
        //     storedRecipes.forEach((recipe, index) => {
        //         const featuredCard = document.createElement('div');
        //         featuredCard.className = 'featured-recipe-card';
        //         featuredCard.innerHTML = `
        //             <a href="./recipe.html?id=${index}">
        //                 <img src="${recipe.recipe_image ? recipe.recipe_image : 'https://i.pinimg.com/736x/e0/a3/21/e0a3218856ac6bf7b68e3a7f7617a828.jpg'}" alt="${recipe.recipe_title || "未命名食譜"}">
        //                 <h3>${recipe.recipe_title || "未命名食譜"}</h3>
        //                 <div class="tags">
        //                     ${(recipe.tags || []).map(tag => `<span>${tag}</span>`).join('') || '<span class="tag">無描述</span>'}
        //                 </div>
        //                 <p>${recipe.recipe_description || "無描述"}</p>
        //             </a>
        //             <div class="actions">
        //                 <a href="#">評分：4.1 / 5 （200 評價）</a>
        //                 <div>
        //                     <button>收藏</button>
        //                     <button>分享</button>
        //                 </div>
        //             </div>
        //         `;
        //         // 將新的 recipeCard 插入到容器的第一個位置
        //         featuredCarousel.insertBefore(featuredCard, featuredCarousel.firstChild);
        //     });

        //     console.log('成功生成卡片');
        // } else {
        //     console.log('未找到數據');
        // }

        // 將陣列倒序排列
        // storedRecipes.reverse();

        // 建立食譜卡片函式
        function createRecipeCard(recipe) {
            // 建立食譜卡片區塊
            const recipeCard = document.createElement("div");
            recipeCard.classList.add("recipe-card");

            // 建立圖片
            const recipeImg = document.createElement('img');
            recipeImg.classList.add('recipe-img');
            if (recipe.recipe_image) {
                recipeImg.src = recipe.recipe_image;
            } else {
                recipeImg.src = '../img/image_Not_Found.png';
                recipeImg.classList.add('not-found-img');
            }
            recipeImg.alt = recipe.recipe_title;

            // 建立內容區塊
            const recipeText = document.createElement('div');

            // 建立連結區塊
            const recipeLink = document.createElement('a');
            recipeLink.classList.add('content');
            recipeLink.href = `./recipe.html?id=${recipe.recipe_id}`;

            // 標題
            const recipeTitle = document.createElement('h2');
            recipeTitle.textContent = recipe.recipe_title;

            // 標籤
            const recipeTag = document.createElement('p');
            recipe.tags.forEach(tag => {
                const spanTag = document.createElement('span');
                spanTag.classList.add('tag');
                spanTag.textContent = tag;
                recipeTag.append(spanTag);
            });

            // 簡介
            const recipeDesc = document.createElement('p');
            recipeDesc.classList.add('recipe-description');
            recipeDesc.textContent = recipe.recipe_description;

            // 食材（並用「, 」隔開）
            const recipeIngredients = document.createElement('p');
            recipeIngredients.textContent = '主要食材：';
            recipe.ingredients.forEach((ingredient, index) => {
                const name = document.createElement('span');
                name.textContent = ingredient.name;
                if (index < recipe.ingredients.length - 1) {
                    name.textContent += ', ';
                }
                recipeIngredients.append(name);
            });

            // 時間
            const recipeTime = document.createElement('p');
            recipeTime.textContent = '製作時間：' + recipe.recipe_cook_time;

            // 將以上區塊組合到連結中
            recipeLink.append(recipeTitle, recipeTag, recipeDesc, recipeIngredients, recipeTime);

            // 建立互動區塊(非使用者輸入數據)
            const recipeActions = document.createElement("div");
            recipeActions.classList.add("actions");
            recipeActions.innerHTML = `
                <a href="#">評分：${recipe.rating} / 5 （${recipe.evaluate} 評價）</a>
                <a href="#">作者：栗子</a>
                <a href="#">喜歡：${recipe.likes}</a>
                <a href="#">留言：${recipe.comments}</a>
                <button class="bookmark-button">收藏</button>
                <button class="share-button">分享</button>
            `;

            // 組合 連結區塊、互動區塊
            recipeText.append(recipeLink, recipeActions);
            // 組合卡片
            recipeCard.append(recipeImg, recipeText);
            return recipeCard;
        }

    </script>
</body>

</html>